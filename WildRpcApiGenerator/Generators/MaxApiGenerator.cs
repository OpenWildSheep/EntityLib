// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version: 16.0.0.0
//  
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace WildRpcApiGenerator
{
    using System.Linq;
    using System.Text;
    using System.Collections.Generic;
    using System;
    
    /// <summary>
    /// Class to produce the template output
    /// </summary>
    
    #line 1 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "16.0.0.0")]
    public partial class MaxApiGenerator : BaseApiGenerator
    {
#line hidden
        /// <summary>
        /// Create the template output
        /// </summary>
        public override string TransformText()
        {
            
            #line 6 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	// convert to the RPC TypeInfo name
	string getRpcType(ReflectionMethod.Parameter param)
	{
		return "Type::" + param.elementType + (param.isArray ? "Array" : "");
	}


	// convert to the target language's type
	string getTargetElementType(ReflectionMethod.Parameter param, bool getUnderlyingType = false)
	{
		return param.elementType switch
		{
			{ } when isEnum(param) && !getUnderlyingType => param.elementTypeName,
			ElementType.Invalid => "void*",
			ElementType.Boolean => "bool",
			ElementType.Integer => "int",
			ElementType.Float => "float",
			ElementType.String => "string",
			_ => param.elementType.ToString(),
		};
	}

	// convert to the target language's type
	string getTargetType(ReflectionMethod.Parameter param)
	{
		var elementType = getTargetElementType(param);
		return param.containerType switch
		{
			ContainerType.Array => $"vector<{elementType}>",
			_ => elementType,
		};
	}


	// convert to the Max SDK type
	string getMaxSdkElementType(ReflectionMethod.Parameter param)
	{
		var elementType = getTargetElementType(param);
		return "Max_" + elementType; // fuck it just prefix everything with Max_ --> all types are typedef'd Max-side, even int/float
		/*if (isEnum(param))
		{
			return elementType;
		}
		return param.elementType switch
		{
			ElementType.Boolean or
			ElementType.String or
			ElementType.Vector3 or
			ElementType.Quat => "Max_" + elementType,
			_ => elementType,
		};*/
	}

	bool isMaxSdkPtrType(ReflectionMethod.Parameter param)
	{
		return param.elementType switch
		{
			ElementType.Boolean or 
				ElementType.Integer or
				ElementType.Float => false,
			_ => true
		};
	}

	// convert to the Max SDK type
	string getMaxSdkType(ReflectionMethod.Parameter param)
	{
		var elementType = getMaxSdkElementType(param);
		var star = isMaxSdkPtrType(param) ? "*" : "";
		return param.containerType switch
		{
			ContainerType.Array => $"Tab<{elementType}{star}>",
			_ => elementType,
		};
	}


	// convert to the MaxScript macro language type
	string getMaxScriptElementType(ReflectionMethod.Parameter param, bool forFunctionMap)
	{
		return param.elementType switch
		{
			{ } when isEnum(param) => forFunctionMap
				? $"TYPE_ENUM"
				: $"TYPE_ENUM, enumID::{param.elementTypeName}",
			ElementType.Vector2 => "TYPE_POINT2",
			ElementType.Vector3 => "TYPE_POINT3",
			ElementType.Color => "TYPE_ACOLOR",
			ElementType.String => "TYPE_TSTR",
			_ => $"TYPE_{getTargetElementType(param, true).ToUpper()}",
		};
	}

	// convert to the MaxScript macro language type
	string getMaxScriptType(ReflectionMethod.Parameter param, bool forFunctionMap, bool isInput)
	{
		var suffix = isInput ? "BR" : "BV";
		var elementType = getMaxScriptElementType(param, forFunctionMap);
		return param.containerType switch
		{
			ContainerType.Array => $"{elementType}_TAB_{suffix}",
			_ => param.elementType == ElementType.String
				? $"{elementType}_{suffix}"
				: elementType,
		};
	}


	string inputSignature(ReflectionMethod.Parameter input)
	{
		return $"const {getMaxSdkType(input)}& {input.name}";
	}

	string inputCall(ReflectionMethod.Parameter input)
	{
		var elementType = getTargetElementType(input);
		var underlyingElementType = getTargetElementType(input, true);
		var cast = elementType != underlyingElementType ? $"(const {underlyingElementType}&)" : "";
		return $"Convert<{getTargetElementType(input, true)}>({cast}{input.name})";
	}


	// MaxScript interfaces need a unique ID, generated with gencid.exe (C:\Program Files\Autodesk\3ds Max 2015 SDK\maxsdk\help\gencid.exe)
	// I generated a pool to pick from... if we need more, just generate more and paste here.
	// Or, we could generate on-demand, and cache per manager name or something... whatever, lazy does it.
	string[] maxClassIds =
	{
		"0x305c0bb7, 0x771c603d",
		"0x17da19d2, 0xdb32de6",
		"0x5e03249d, 0x46422728",
		"0x5ab0af8, 0x3e3f34d2",
		"0x47712a98, 0x31d35f00",
		"0x6d1c7b24, 0x23d52515",
		"0x1ff10d33, 0x64c95867",
		"0x5628158a, 0x61f15902",
		"0xaf7136d, 0x631775e9",
		"0x62d469e2, 0x14bd548c",
		"0x14d05004, 0x77dd0d24",
		"0x559a4eb8, 0x6e3c7187",
		"0x7bab34d5, 0x537c1987",
		"0x21bb1af1, 0x38bb4187",
		"0x4a667631, 0x397e50fc",
		"0x6917106b, 0x10ca3e88",
	};

	bool isValid(ReflectionClass @class)
	{
		//return @class.name == "RPCMarshallingTests";
		return @class.name == "CameraManager";
		return true;
	}

            
            #line default
            #line hidden
            this.Write("/*\r\nRPC bindings for the Wild game.\r\n\r\nTHIS FILE WAS AUTOGENERATED.\r\n*/\r\n\r\n#pragm" +
                    "a once\r\n#include \"RpcApi.h\"\r\n\r\nnamespace WRPC\r\n{\r\n//\r\n// Enums\r\n//\r\n\r\n");
            
            #line 174 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	foreach (var @enum in reflectionDb.enums)
	{

            
            #line default
            #line hidden
            this.Write("enum class ");
            
            #line 178 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@enum.name));
            
            #line default
            #line hidden
            this.Write("\r\n{\r\n");
            
            #line 180 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		foreach (var (value, name) in @enum.values.Zip(@enum.names))
		{
			if (name.EndsWith("_COUNT")) continue;

            
            #line default
            #line hidden
            this.Write("\t");
            
            #line 185 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(name));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 185 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 186 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		}

            
            #line default
            #line hidden
            this.Write("};\r\ntypedef int Max_");
            
            #line 190 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@enum.name));
            
            #line default
            #line hidden
            this.Write(";\r\n\r\n");
            
            #line 192 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	} // foreach enums

            
            #line default
            #line hidden
            this.Write("\r\nenum class enumID : EnumID\r\n{\r\n");
            
            #line 198 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	foreach (var @enum in reflectionDb.enums)
	{

            
            #line default
            #line hidden
            this.Write("\t");
            
            #line 202 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@enum.name));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 203 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	}

            
            #line default
            #line hidden
            this.Write("};\r\n\r\ninline void AppendEnums(FPInterfaceDesc& _interface)\r\n{\r\n");
            
            #line 210 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	foreach (var @enum in reflectionDb.enums)
	{

            
            #line default
            #line hidden
            this.Write("\t_interface.AppendEnum(\r\n\t\t(EnumID)enumID::");
            
            #line 215 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@enum.name));
            
            #line default
            #line hidden
            this.Write(", ");
            
            #line 215 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@enum.values.Length));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 216 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		foreach (var (value, name) in @enum.values.Zip(@enum.names))
		{
			//if (name.EndsWith("_COUNT")) continue;

            
            #line default
            #line hidden
            this.Write("\t\t_M(\"");
            
            #line 221 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(name));
            
            #line default
            #line hidden
            this.Write("\"), ");
            
            #line 221 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 222 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		}

            
            #line default
            #line hidden
            this.Write("\tp_end);\r\n\r\n");
            
            #line 227 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	} // foreach enums

            
            #line default
            #line hidden
            this.Write("}\r\n\r\n\r\n//\r\n// Managers\r\n//\r\n\r\n");
            
            #line 237 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	// manager classes
	foreach (var (iC, @class) in reflectionDb.classes.Enumerate())
	{
		if (!isValid(@class)) continue;

            
            #line default
            #line hidden
            this.Write("class ");
            
            #line 243 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write(" : public Manager\r\n{\r\npublic:\r\n\t");
            
            #line 246 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write("(RpcApi& api)\r\n\t\t: Manager(api, {");
            
            #line 247 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(maxClassIds[iC]));
            
            #line default
            #line hidden
            this.Write("}, _M(\"");
            
            #line 247 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write("\"))\r\n\t{\r\n\t\tAppendEnums(*this);\r\n\t\tAppendFunctions();\r\n\t}\r\n\r\n");
            
            #line 253 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		var validMethods = @class.validMethods
			.Where(m => m.parameters.All(p => p.elementType != ElementType.Position)) // exclude methods with a Position -> can't bind to MaxScript
			.ToArray();

		// manager method signatures
		foreach (var method in @class.methods)
		{

            
            #line default
            #line hidden
            this.Write("\tMethodInvocation _");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.name));
            
            #line default
            #line hidden
            this.Write(" = MethodInvocation(\"");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write("\", \"");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.name));
            
            #line default
            #line hidden
            this.Write("\", {");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.inputs.join(getRpcType)));
            
            #line default
            #line hidden
            this.Write("}, {");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.outputs.join(getRpcType)));
            
            #line default
            #line hidden
            this.Write("}); // ");
            
            #line 262 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.threadSafe ? "" : "non "));
            
            #line default
            #line hidden
            this.Write("thread-safe\r\n");
            
            #line 263 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		}

            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 267 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		// manager method wrappers
		foreach (var method in validMethods)
		{
			var inputCalls = method.inputs.join(inputCall);

            
            #line default
            #line hidden
            this.Write("\tauto ");
            
            #line 273 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.niceName()));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 273 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.inputs.join(inputSignature)));
            
            #line default
            #line hidden
            this.Write(")\r\n\t{\r\n");
            
            #line 275 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

			if (method.outputs.Length == 0)
			{

            
            #line default
            #line hidden
            this.Write("\t\tapi.Execute(_");
            
            #line 279 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.name));
            
            #line default
            #line hidden
            this.Write(", {");
            
            #line 279 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(inputCalls));
            
            #line default
            #line hidden
            this.Write("});\r\n");
            
            #line 280 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

			}
			else //if (method.outputs.Length == 1)
			{

            
            #line default
            #line hidden
            this.Write("\t\tauto result = api.Execute(_");
            
            #line 285 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.name));
            
            #line default
            #line hidden
            this.Write(", {");
            
            #line 285 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(inputCalls));
            
            #line default
            #line hidden
            this.Write("});\r\n");
            
            #line 286 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

				// some parameters need custom converters
				foreach (var (iO, output) in method.outputs.Enumerate())
				{
					var containerAs = output.containerType == ContainerType.Array ? "Vector" : "Scalar";
					var rpcElementType = getTargetElementType(output, true);
					var maxElementType = getMaxSdkElementType(output);
					var convert = isMaxSdkPtrType(output) ? "ConvertPtr" : "Convert";

            
            #line default
            #line hidden
            this.Write("\t\tauto ");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(output.name));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(convert));
            
            #line default
            #line hidden
            this.Write("<");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(maxElementType));
            
            #line default
            #line hidden
            this.Write(">(result.GetParameter(");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(iO));
            
            #line default
            #line hidden
            this.Write(").As");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(containerAs));
            
            #line default
            #line hidden
            this.Write("<");
            
            #line 295 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(rpcElementType));
            
            #line default
            #line hidden
            this.Write(">());\r\n");
            
            #line 296 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

				}
				var returnValue = method.outputs.Length == 1
					? method.outputs[0].name
					: $"std::make_tuple({method.outputs.joinNames()})";

            
            #line default
            #line hidden
            this.Write("\t\treturn ");
            
            #line 302 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnValue));
            
            #line default
            #line hidden
            this.Write(";\r\n");
            
            #line 303 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

			}

            
            #line default
            #line hidden
            this.Write("\t}\r\n\r\n");
            
            #line 308 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		} // method wrappers foreach

            
            #line default
            #line hidden
            this.Write("\r\n\r\n\tvoid AppendFunctions()\r\n\t{\r\n");
            
            #line 315 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		// AppendFunction: see https://area.autodesk.com/blogs/the-3ds-max-blog/adding_new_functions_written_in_c_to_maxscript/
		foreach (var (iM, method) in validMethods.Enumerate())
		{
			var returnType = method.outputs.Length switch
			{
				0 => "TYPE_VOID",
				1 => getMaxScriptType(method.outputs[0], false, false),
				_ => "TYPE_OBJECT_TAB",
			};

            
            #line default
            #line hidden
            this.Write("\t\tAppendFunction(\r\n\t\t\t");
            
            #line 327 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(iM));
            
            #line default
            #line hidden
            this.Write(", _M(\"");
            
            #line 327 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.niceName()));
            
            #line default
            #line hidden
            this.Write("\"), 0,\r\n\t\t\t");
            
            #line 328 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnType));
            
            #line default
            #line hidden
            this.Write(", 0,\r\n\t\t\t");
            
            #line 329 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.inputs.Length));
            
            #line default
            #line hidden
            this.Write(", // input count\r\n");
            
            #line 330 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

			foreach (var input in method.inputs)
			{

            
            #line default
            #line hidden
            this.Write("\t\t\t_M(\"");
            
            #line 334 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(input.name));
            
            #line default
            #line hidden
            this.Write("\"), 0, ");
            
            #line 334 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(getMaxScriptType(input, false, true)));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 335 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

			}

            
            #line default
            #line hidden
            this.Write("\t\tp_end);\r\n\r\n");
            
            #line 340 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		} // AppendFunction foreach

            
            #line default
            #line hidden
            this.Write("\t}\r\n\r\n\tBEGIN_FUNCTION_MAP\r\n");
            
            #line 346 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		foreach (var (iM, method) in validMethods.Enumerate())
		{
			var returnType = method.outputs.Length switch
			{
				0 => "",
				1 => ", " + getMaxScriptType(method.outputs[0], true, false),
				_ => ", " + "TYPE_OBJECT_TAB",
			};

			var inputTypes = method.inputs.join(input => getMaxScriptType(input, true, true));
			if (inputTypes != "") inputTypes = ", " + inputTypes;

            
            #line default
            #line hidden
            this.Write("\t\t");
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnType == "" ? "V" : ""));
            
            #line default
            #line hidden
            this.Write("FN_");
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.inputs.Length));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(iM));
            
            #line default
            #line hidden
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnType));
            
            #line default
            #line hidden
            this.Write(", ");
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(method.niceName()));
            
            #line default
            #line hidden
            
            #line 359 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(inputTypes));
            
            #line default
            #line hidden
            this.Write(")\r\n");
            
            #line 360 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

		} // FUNCTION_MAP foreach

            
            #line default
            #line hidden
            this.Write("\tEND_FUNCTION_MAP\r\n};\r\n\r\n");
            
            #line 366 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	} // foreach manager

            
            #line default
            #line hidden
            this.Write("\r\n//\r\n// API\r\n//\r\n\r\nclass RpcApiWild : RpcApi\r\n{\r\npublic:\r\n\tRpcApiWild(Connection" +
                    "& _connection) : RpcApi(_connection) { }\r\n\r\n");
            
            #line 379 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	// manager instances
	foreach (var @class in reflectionDb.classes)
	{
		if (!isValid(@class)) continue;
		var memberName = @class.name.Replace("Manager", "").ToLowerFirstLetter();
		memberName = memberName.Replace("rPC", "rpc");

            
            #line default
            #line hidden
            this.Write("\t");
            
            #line 387 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 387 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(memberName));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 387 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(@class.name));
            
            #line default
            #line hidden
            this.Write("(*this);\r\n");
            
            #line 388 "D:\WildCode\WildShared\WildRpcApiGenerator\Generators\MaxApiGenerator.tt"

	}

            
            #line default
            #line hidden
            this.Write("};\r\n} // namespace WRPC\r\n");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
